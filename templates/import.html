{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Import from Google Sheets</h2>
    <p class="text-muted">Upload an Excel file (.xlsx) exported from Google Sheets to import budget and transaction data.</p>

    <!-- Step 1: Upload File -->
    <div class="card mb-4">
        <div class="card-header">
            <strong>Step 1:</strong> Upload Excel File
        </div>
        <div class="card-body">
            <form id="upload-form">
                <div class="mb-3">
                    <label for="file-input" class="form-label">Excel File (.xlsx)</label>
                    <input type="file" class="form-control" id="file-input" accept=".xlsx" required>
                    <div class="form-text">Export your Google Sheet as .xlsx (File → Download → Microsoft Excel)</div>
                </div>
                <div class="mb-3">
                    <label for="year-input" class="form-label">Year</label>
                    <input type="number" class="form-control year-input" id="year-input"
                           min="2000" max="2100" value="{{ current_year }}" required>
                    <div class="form-text">The year this data belongs to</div>
                </div>
                <button type="submit" class="btn btn-primary" id="parse-btn">
                    <span class="spinner-border spinner-border-sm d-none" id="parse-spinner"></span>
                    Parse File
                </button>
            </form>
        </div>
    </div>

    <!-- Step 2: Category Mapping (hidden until file parsed) -->
    <div class="card mb-4 d-none" id="mapping-section">
        <div class="card-header">
            <strong>Step 2:</strong> Map Categories
        </div>
        <div class="card-body">
            <p class="text-muted">Map each Google Sheets category to a Moneybags category.</p>
            <div id="mapping-container"></div>
            <button type="button" class="btn btn-primary mt-3" id="validate-btn">
                <span class="spinner-border spinner-border-sm d-none" id="validate-spinner"></span>
                Validate Import
            </button>
        </div>
    </div>

    <!-- Step 3: Preview & Import (hidden until validated) -->
    <div class="card mb-4 d-none" id="preview-section">
        <div class="card-header">
            <strong>Step 3:</strong> Preview & Import
        </div>
        <div class="card-body">
            <div id="validation-results"></div>
            <button type="button" class="btn btn-success mt-3 d-none" id="import-btn">
                <span class="spinner-border spinner-border-sm d-none" id="import-spinner"></span>
                Import Data
            </button>
        </div>
    </div>
</div>

<!-- Import Confirmation Modal -->
<div class="modal fade" id="confirmImportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-2"></i>Confirm Import</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><strong>Are you sure you want to import this data?</strong></p>
                <p class="mb-0">This will create:</p>
                <ul id="confirm-import-summary"></ul>
                <p class="text-muted mb-0"><small>This action cannot be undone.</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" id="confirmImportBtn">Import Data</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
